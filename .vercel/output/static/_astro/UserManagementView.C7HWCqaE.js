import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as i}from"./index.JXKNaeUN.js";import{E as q,a as $,C as R,M as J,I as k,c as P,d as Q,B as Y,A as z}from"./Components.gAA2fnHL.js";import{g as G,e as K,f as X,h as Z,i as ee,u as ae,j as te,k as se,l as re}from"./api.CU3TVay2.js";function ne({columns:l=[],data:y=[],searchable:B=!0,searchPlaceholder:j="Search...",pagination:w=!0,pageSize:h=10,emptyTitle:m="No data found",emptyDescription:v="There's nothing to display here yet.",onRowClick:M}){const[N,I]=i.useState(""),[c,L]=i.useState(1),[x,_]=i.useState({key:null,direction:"asc"}),S=i.useMemo(()=>N?y.filter(s=>l.some(o=>{const r=s[o.key];return r==null?!1:String(r).toLowerCase().includes(N.toLowerCase())})):y,[y,N,l]),b=i.useMemo(()=>x.key?[...S].sort((s,o)=>{const r=s[x.key],p=o[x.key];if(r==null)return 1;if(p==null)return-1;if(typeof r=="number"&&typeof p=="number")return x.direction==="asc"?r-p:p-r;const D=String(r).toLowerCase(),A=String(p).toLowerCase();return x.direction==="asc"?D.localeCompare(A):A.localeCompare(D)}):S,[S,x]),g=i.useMemo(()=>{if(!w)return b;const s=(c-1)*h;return b.slice(s,s+h)},[b,c,h,w]),u=Math.ceil(b.length/h),C=s=>{_(o=>({key:s,direction:o.key===s&&o.direction==="asc"?"desc":"asc"}))},d=s=>{L(Math.max(1,Math.min(s,u)))};return y.length===0?e.jsx(q,{title:m,description:v}):e.jsxs("div",{className:"space-y-4",children:[B&&e.jsxs("div",{className:"relative",children:[e.jsx("svg",{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-neutral-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),e.jsx("input",{type:"text",placeholder:j,value:N,onChange:s=>{I(s.target.value),L(1)},className:"input pl-10 max-w-sm"})]}),e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"data-table",children:[e.jsx("thead",{children:e.jsx("tr",{children:l.map(s=>e.jsx("th",{onClick:()=>s.sortable!==!1&&C(s.key),className:s.sortable!==!1?"cursor-pointer select-none hover:bg-neutral-100 dark:hover:bg-neutral-800":"",children:e.jsxs("div",{className:"flex items-center gap-2",children:[s.header,s.sortable!==!1&&x.key===s.key&&e.jsx("span",{className:"text-primary-500",children:x.direction==="asc"?"↑":"↓"})]})},s.key))})}),e.jsx("tbody",{children:g.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:l.length,className:"text-center py-8 text-neutral-500",children:['No results found for "',N,'"']})}):g.map((s,o)=>e.jsx("tr",{onClick:()=>M&&M(s),className:M?"cursor-pointer":"",children:l.map(r=>e.jsx("td",{children:r.render?r.render(s[r.key],s):s[r.key]},r.key))},s.id||o))})]})}),w&&u>1&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-neutral-500",children:["Showing ",(c-1)*h+1," to ",Math.min(c*h,b.length)," of ",b.length," results"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>d(c-1),disabled:c===1,className:"p-2 rounded-lg hover:bg-neutral-100 dark:hover:bg-neutral-800 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),Array.from({length:Math.min(5,u)},(s,o)=>{let r;return u<=5||c<=3?r=o+1:c>=u-2?r=u-4+o:r=c-2+o,e.jsx("button",{onClick:()=>d(r),className:`w-10 h-10 rounded-lg text-sm font-medium transition-colors ${c===r?"bg-primary-600 text-white":"hover:bg-neutral-100 dark:hover:bg-neutral-800 text-neutral-700 dark:text-neutral-300"}`,children:r},r)}),e.jsx("button",{onClick:()=>d(c+1),disabled:c===u,className:"p-2 rounded-lg hover:bg-neutral-100 dark:hover:bg-neutral-800 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]})]})]})}function de(){const[l,y]=i.useState("students"),[B,j]=i.useState(!1),[w,h]=i.useState(!1),[m,v]=i.useState(null),[M,N]=i.useState([]),[I,c]=i.useState([]),[L,x]=i.useState([]),[_,S]=i.useState(!0),[b,g]=i.useState(null),[u,C]=i.useState(!1),[d,s]=i.useState({}),o=[{id:"students",label:"Students"},{id:"teachers",label:"Teachers"},{id:"parents",label:"Parents"}];i.useEffect(()=>{r()},[l]);const r=async()=>{S(!0),g(null);try{if(l==="students"){const a=await G();N(p(a))}else if(l==="teachers"){const a=await K();c(D(a))}else if(l==="parents"){const a=await X();x(a)}}catch(a){console.error("Error fetching data:",a),g(a.message||"Failed to fetch data. Please check your Supabase configuration.")}finally{S(!1)}},p=a=>(console.log("Raw student data from Supabase:",a),a.map((t,n)=>{const T={...t,firstName:t.first_name||t.firstName||"",lastName:t.last_name||t.lastName||"",regNumber:t.reg_number||t.regNumber||"",parentId:t.parent_id||t.parentId,dateOfBirth:t.date_of_birth||t.dateOfBirth,enrollmentDate:t.enrollment_date||t.enrollmentDate};return n<3&&console.log(`Student ${n+1} transformed:`,{original_reg_number:t.reg_number,original_first_name:t.first_name,original_last_name:t.last_name,transformed:{regNumber:T.regNumber,firstName:T.firstName,lastName:T.lastName}}),T})),D=a=>a.map(t=>({...t,firstName:t.first_name,lastName:t.last_name,staffId:t.staff_id})),A=(a,t)=>{const n={first_name:a.firstName,last_name:a.lastName,email:a.email,phone:a.phone};return t==="student"?{...n,reg_number:a.regNumber||`USS/${new Date().getFullYear()}/${String(Math.floor(Math.random()*1e3)).padStart(3,"0")}`,gender:a.gender||"",date_of_birth:a.dateOfBirth||null,class:a.class,arm:a.arm,status:a.status||"Active"}:t==="teacher"?{...n,staff_id:a.staffId||`TCH/${new Date().getFullYear()}/${String(Math.floor(Math.random()*1e3)).padStart(3,"0")}`,gender:a.gender||"",subjects:a.subjects||[],classes:a.classes||[],qualification:a.qualification||"",status:a.status||"Active"}:t==="parent"?{...n,title:a.title||"",occupation:a.occupation||"",address:a.address||""}:n},E=()=>{switch(l){case"students":return M;case"teachers":return I;case"parents":return L;default:return[]}},F=()=>{const a=[{key:"name",header:"Name",render:(t,n)=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(z,{name:`${n.firstName} ${n.lastName}`,src:n.avatar,size:"sm"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-neutral-900 dark:text-white",children:[n.firstName," ",n.lastName]}),e.jsx("p",{className:"text-xs text-neutral-500",children:n.email})]})]})},{key:"phone",header:"Phone"}];return l==="students"?[...a,{key:"regNumber",header:"Reg Number",render:(t,n)=>(console.log("Rendering regNumber for row:",{regNumber:t,fullRow:n}),e.jsx("span",{className:"font-mono text-xs",children:t||"N/A"}))},{key:"class",header:"Class",render:(t,n)=>`${t} ${n.arm}`},{key:"loginCredentials",header:"Login Credentials",render:(t,n)=>e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-neutral-500",children:"Username:"}),e.jsx("span",{className:"text-xs font-medium font-mono",children:n.firstName})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-neutral-500",children:"Password:"}),e.jsx("span",{className:"text-xs font-medium font-mono",children:n.regNumber}),e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(n.regNumber)},className:"p-1 hover:bg-neutral-100 dark:hover:bg-neutral-700 rounded",title:"Copy password",children:e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]})]})},{key:"status",header:"Status",render:t=>e.jsx(Y,{variant:t==="Active"?"success":"danger",children:t})}]:l==="teachers"?[...a,{key:"staffId",header:"Staff ID",render:t=>e.jsx("span",{className:"font-mono text-xs",children:t})},{key:"subjects",header:"Subjects",render:t=>e.jsx("span",{className:"text-xs",children:Array.isArray(t)?t.join(", "):t})},{key:"loginCredentials",header:"Login Credentials",render:(t,n)=>e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-neutral-500",children:"Username:"}),e.jsx("span",{className:"text-xs font-medium font-mono",children:n.firstName})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-neutral-500",children:"Password:"}),e.jsx("span",{className:"text-xs font-medium font-mono",children:n.staffId}),e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(n.staffId)},className:"p-1 hover:bg-neutral-100 dark:hover:bg-neutral-700 rounded",title:"Copy password",children:e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]})]})}]:[...a,{key:"title",header:"Title"},{key:"occupation",header:"Occupation"},{key:"address",header:"Address",render:t=>e.jsx("span",{className:"truncate max-w-[200px] block",title:t,children:t})}]},O=a=>{v(a),s(a),j(!0)},U=a=>{v(a),h(!0)},H=async()=>{if(m){C(!0);try{l==="students"?await Z(m.id):l==="teachers"&&await ee(m.id),await r(),h(!1),v(null)}catch(a){console.error("Error deleting:",a),g(a.message||"Failed to delete. Please try again.")}finally{C(!1)}}},W=async()=>{C(!0),g(null);try{const a=A(d,l.slice(0,-1));m?l==="students"?await ae(m.id,a):l==="teachers"&&await te(m.id,a):l==="students"?await se(a):l==="teachers"&&await re(a),await r(),j(!1),v(null),s({})}catch(a){console.error("Error saving:",a),g(a.message||"Failed to save. Please try again.")}finally{C(!1)}},V=()=>{v(null),s({}),j(!0)},f=(a,t)=>{s(n=>({...n,[a]:t}))};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-neutral-900 dark:text-white",children:"User Management"}),e.jsx("p",{className:"text-neutral-500 mt-1",children:"Manage students, teachers, and parents accounts"})]}),e.jsxs($,{onClick:V,disabled:_,children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add New ",l.slice(0,-1)]})]}),e.jsxs(R,{padding:!1,children:[e.jsx("div",{className:"border-b border-neutral-200 dark:border-neutral-700 px-6 pt-4",children:e.jsx("div",{className:"flex gap-6",children:o.map(a=>e.jsxs("button",{onClick:()=>y(a.id),disabled:_,className:`pb-4 text-sm font-medium transition-colors relative ${l===a.id?"text-primary-600 dark:text-primary-400":"text-neutral-500 hover:text-neutral-700 dark:hover:text-neutral-300"}`,children:[a.label,l===a.id&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-primary-600 dark:bg-primary-400 rounded-t-full"})]},a.id))})}),e.jsx("div",{className:"p-6",children:_?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"}),e.jsx("span",{className:"ml-3 text-neutral-600 dark:text-neutral-400",children:"Loading..."})]}):e.jsx(ne,{columns:[...F(),{key:"actions",header:"",render:(a,t)=>e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>O(t),className:"p-1 text-neutral-400 hover:text-primary-600 transition-colors",title:"Edit",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx("button",{onClick:()=>U(t),className:"p-1 text-neutral-400 hover:text-danger-600 transition-colors",title:"Delete",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})}],data:E(),searchPlaceholder:`Search ${l}...`})})]}),e.jsxs(J,{isOpen:B,onClose:()=>j(!1),title:`${m?"Edit":"Add New"} ${l.slice(0,-1)}`,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(k,{label:"First Name",value:d.firstName||"",onChange:a=>f("firstName",a.target.value)}),e.jsx(k,{label:"Last Name",value:d.lastName||"",onChange:a=>f("lastName",a.target.value)})]}),e.jsx(k,{label:"Email",type:"email",value:d.email||"",onChange:a=>f("email",a.target.value)}),e.jsx(k,{label:"Phone",type:"tel",value:d.phone||"",onChange:a=>f("phone",a.target.value)}),l==="students"&&e.jsxs(e.Fragment,{children:[e.jsx(k,{label:"Registration Number",value:d.regNumber||"",onChange:a=>f("regNumber",a.target.value),placeholder:"Auto-generated if left blank (e.g. USS/2024/001)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(P,{label:"Class",options:["SS 1","SS 2","SS 3","JSS 1","JSS 2","JSS 3"].map(a=>({value:a,label:a})),value:d.class||"",onChange:a=>f("class",a.target.value)}),e.jsx(P,{label:"Arm",options:["A","B","C","Science","Arts","Commercial"].map(a=>({value:a,label:a})),value:d.arm||"",onChange:a=>f("arm",a.target.value)})]})]}),l==="teachers"&&e.jsxs(e.Fragment,{children:[e.jsx(k,{label:"Staff ID",value:d.staffId||"",onChange:a=>f("staffId",a.target.value),placeholder:"Auto-generated if left blank (e.g. TCH/2024/001)"}),e.jsx(k,{label:"Qualification",value:d.qualification||"",onChange:a=>f("qualification",a.target.value),placeholder:"e.g., B.Sc Mathematics"})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[e.jsx($,{variant:"ghost",onClick:()=>j(!1),disabled:u,children:"Cancel"}),e.jsx($,{onClick:W,disabled:u,children:u?"Saving...":"Save Changes"})]})]}),e.jsx(Q,{isOpen:w,onClose:()=>h(!1),onConfirm:H,title:"Delete User",message:`Are you sure you want to delete ${m?.firstName} ${m?.lastName}? This action cannot be undone.`,confirmText:u?"Deleting...":"Delete User",variant:"danger"})]})}export{de as default};
