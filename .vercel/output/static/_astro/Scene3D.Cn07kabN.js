import{j as se}from"./jsx-runtime.D_zvdyIk.js";import{r as W}from"./index.JXKNaeUN.js";import{R as Dt,M as Er,I as Bt,a as Sr,D as kt,b as zr,H as Me,c as Oe,d as Ge,L as Re,e as rr,f as Lt,g as ke,h as Gr,O as Pt,i as Zr,W as Wr,U as ur,j as Ht,k as zt,l as mr,T as Ze,m as Gt,n as Zt,o as Wt,B as $t,p as Xt,q as _r,r as Yt,s as jt,t as Lr,v as Vt,w as cr,N as qt,V as Ke,x as tr,y as hr,z as Kt,E as Qt,A as Jt,G as ea,_ as ra,J as ta,u as $r,K as aa,Q as Pr,C as na,P as ia,F as oa,S as sa}from"./Stars.Dx3OXl-V.js";import"./index.Bb8JjhAW.js";const Xr=parseInt(Dt.replace(/\D+/g,""));var Se=Uint8Array,Le=Uint16Array,wr=Uint32Array,Yr=new Se([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),jr=new Se([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),la=new Se([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Vr=function(n,t){for(var i=new Le(31),s=0;s<31;++s)i[s]=t+=1<<n[s-1];for(var u=new wr(i[30]),s=1;s<30;++s)for(var h=i[s];h<i[s+1];++h)u[h]=h-i[s]<<5|s;return[i,u]},qr=Vr(Yr,2),Kr=qr[0],ca=qr[1];Kr[28]=258,ca[258]=28;var ua=Vr(jr,0),ha=ua[0],yr=new Le(32768);for(var J=0;J<32768;++J){var Be=(J&43690)>>>1|(J&21845)<<1;Be=(Be&52428)>>>2|(Be&13107)<<2,Be=(Be&61680)>>>4|(Be&3855)<<4,yr[J]=((Be&65280)>>>8|(Be&255)<<8)>>>1}var er=(function(n,t,i){for(var s=n.length,u=0,h=new Le(t);u<s;++u)++h[n[u]-1];var d=new Le(t);for(u=0;u<t;++u)d[u]=d[u-1]+h[u-1]<<1;var E;if(i){E=new Le(1<<t);var g=15-t;for(u=0;u<s;++u)if(n[u])for(var f=u<<4|n[u],A=t-n[u],R=d[n[u]-1]++<<A,b=R|(1<<A)-1;R<=b;++R)E[yr[R]>>>g]=f}else for(E=new Le(s),u=0;u<s;++u)n[u]&&(E[u]=yr[d[n[u]-1]++]>>>15-n[u]);return E}),nr=new Se(288);for(var J=0;J<144;++J)nr[J]=8;for(var J=144;J<256;++J)nr[J]=9;for(var J=256;J<280;++J)nr[J]=7;for(var J=280;J<288;++J)nr[J]=8;var Qr=new Se(32);for(var J=0;J<32;++J)Qr[J]=5;var da=er(nr,9,1),pa=er(Qr,5,1),vr=function(n){for(var t=n[0],i=1;i<n.length;++i)n[i]>t&&(t=n[i]);return t},Te=function(n,t,i){var s=t/8|0;return(n[s]|n[s+1]<<8)>>(t&7)&i},gr=function(n,t){var i=t/8|0;return(n[i]|n[i+1]<<8|n[i+2]<<16)>>(t&7)},va=function(n){return(n/8|0)+(n&7&&1)},ga=function(n,t,i){(i==null||i>n.length)&&(i=n.length);var s=new(n instanceof Le?Le:n instanceof wr?wr:Se)(i-t);return s.set(n.subarray(t,i)),s},fa=function(n,t,i){var s=n.length;if(!s||i&&!i.l&&s<5)return t||new Se(0);var u=!t||i,h=!i||i.i;i||(i={}),t||(t=new Se(s*3));var d=function(X){var Fe=t.length;if(X>Fe){var Ae=new Se(Math.max(Fe*2,X));Ae.set(t),t=Ae}},E=i.f||0,g=i.p||0,f=i.b||0,A=i.l,R=i.d,b=i.m,L=i.n,G=s*8;do{if(!A){i.f=E=Te(n,g,1);var de=Te(n,g+1,3);if(g+=3,de)if(de==1)A=da,R=pa,b=9,L=5;else if(de==2){var pe=Te(n,g,31)+257,le=Te(n,g+10,15)+4,P=pe+Te(n,g+5,31)+1;g+=14;for(var N=new Se(P),ee=new Se(19),S=0;S<le;++S)ee[la[S]]=Te(n,g+S*3,7);g+=le*3;for(var I=vr(ee),k=(1<<I)-1,Z=er(ee,I,1),S=0;S<P;){var B=Z[Te(n,g,k)];g+=B&15;var $=B>>>4;if($<16)N[S++]=$;else{var H=0,C=0;for($==16?(C=3+Te(n,g,3),g+=2,H=N[S-1]):$==17?(C=3+Te(n,g,7),g+=3):$==18&&(C=11+Te(n,g,127),g+=7);C--;)N[S++]=H}}var re=N.subarray(0,pe),O=N.subarray(pe);b=vr(re),L=vr(O),A=er(re,b,1),R=er(O,L,1)}else throw"invalid block type";else{var $=va(g)+4,ie=n[$-4]|n[$-3]<<8,oe=$+ie;if(oe>s){if(h)throw"unexpected EOF";break}u&&d(f+ie),t.set(n.subarray($,oe),f),i.b=f+=ie,i.p=g=oe*8;continue}if(g>G){if(h)throw"unexpected EOF";break}}u&&d(f+131072);for(var Ie=(1<<b)-1,Pe=(1<<L)-1,xe=g;;xe=g){var H=A[gr(n,g)&Ie],K=H>>>4;if(g+=H&15,g>G){if(h)throw"unexpected EOF";break}if(!H)throw"invalid length/literal";if(K<256)t[f++]=K;else if(K==256){xe=g,A=null;break}else{var Ne=K-254;if(K>264){var S=K-257,te=Yr[S];Ne=Te(n,g,(1<<te)-1)+Kr[S],g+=te}var he=R[gr(n,g)&Pe],be=he>>>4;if(!he)throw"invalid distance";g+=he&15;var O=ha[be];if(be>3){var te=jr[be];O+=gr(n,g)&(1<<te)-1,g+=te}if(g>G){if(h)throw"unexpected EOF";break}u&&d(f+131072);for(var $e=f+Ne;f<$e;f+=4)t[f]=t[f-O],t[f+1]=t[f+1-O],t[f+2]=t[f+2-O],t[f+3]=t[f+3-O];f=$e}}i.l=A,i.p=xe,i.b=f,A&&(E=1,i.m=b,i.d=R,i.n=L)}while(!E);return f==t.length?t:ga(t,0,f)},ma=new Se(0),_a=function(n){if((n[0]&15)!=8||n[0]>>>4>7||(n[0]<<8|n[1])%31)throw"invalid zlib data";if(n[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function sr(n,t){return fa((_a(n),n.subarray(2,-4)),t)}var wa=typeof TextDecoder<"u"&&new TextDecoder,ya=0;try{wa.decode(ma,{stream:!0}),ya=1}catch{}const Ea=n=>n&&n.isCubeTexture;class Sa extends Er{constructor(t,i){var s,u;const h=Ea(t),E=((u=h?(s=t.image[0])==null?void 0:s.width:t.image.width)!=null?u:1024)/4,g=Math.floor(Math.log2(E)),f=Math.pow(2,g),A=3*Math.max(f,112),R=4*f,b=[h?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/A}`,`#define CUBEUV_TEXEL_HEIGHT ${1/R}`,`#define CUBEUV_MAX_MIP ${g}.0`],L=`
        varying vec3 vWorldPosition;
        void main() 
        {
            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
        `,G=b.join(`
`)+`
        #define ENVMAP_TYPE_CUBE_UV
        varying vec3 vWorldPosition;
        uniform float radius;
        uniform float height;
        uniform float angle;
        #ifdef ENVMAP_TYPE_CUBE
            uniform samplerCube map;
        #else
            uniform sampler2D map;
        #endif
        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {
            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;
        }
        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {
            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;
        }
        vec3 project() 
        {
            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;
            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;
            } else {
                p = vec3( 0.0, 1.0, 0.0 );
            }
            return p;
        }
        #include <common>
        #include <cube_uv_reflection_fragment>
        void main() 
        {
            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE
                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;
            #else
                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;
            #endif
            gl_FragColor = vec4( outcolor, 1.0 );
            #include <tonemapping_fragment>
            #include <${Xr>=154?"colorspace_fragment":"encodings_fragment"}>
        }
        `,de={map:{value:t},height:{value:i?.height||15},radius:{value:i?.radius||100}},$=new Bt(1,16),ie=new Sr({uniforms:de,fragmentShader:G,vertexShader:L,side:kt});super($,ie)}set radius(t){this.material.uniforms.radius.value=t}get radius(){return this.material.uniforms.radius.value}set height(t){this.material.uniforms.height.value=t}get height(){return this.material.uniforms.height.value}}class Ma extends zr{constructor(t){super(t),this.type=Me}parse(t){const d=function(S,I){switch(S){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(I||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(I||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(I||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(I||""))}},R=function(S,I,k){I=I||1024;let B=S.pos,H=-1,C=0,re="",O=String.fromCharCode.apply(null,new Uint16Array(S.subarray(B,B+128)));for(;0>(H=O.indexOf(`
`))&&C<I&&B<S.byteLength;)re+=O,C+=O.length,B+=128,O+=String.fromCharCode.apply(null,new Uint16Array(S.subarray(B,B+128)));return-1<H?(S.pos+=C+H+1,re+O.slice(0,H)):!1},b=function(S){const I=/^#\?(\S+)/,k=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,Z=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,B=/^\s*FORMAT=(\S+)\s*$/,H=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,C={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let re,O;for((S.pos>=S.byteLength||!(re=R(S)))&&d(1,"no header found"),(O=re.match(I))||d(3,"bad initial token"),C.valid|=1,C.programtype=O[1],C.string+=re+`
`;re=R(S),re!==!1;){if(C.string+=re+`
`,re.charAt(0)==="#"){C.comments+=re+`
`;continue}if((O=re.match(k))&&(C.gamma=parseFloat(O[1])),(O=re.match(Z))&&(C.exposure=parseFloat(O[1])),(O=re.match(B))&&(C.valid|=2,C.format=O[1]),(O=re.match(H))&&(C.valid|=4,C.height=parseInt(O[1],10),C.width=parseInt(O[2],10)),C.valid&2&&C.valid&4)break}return C.valid&2||d(3,"missing format specifier"),C.valid&4||d(3,"missing image size specifier"),C},L=function(S,I,k){const Z=I;if(Z<8||Z>32767||S[0]!==2||S[1]!==2||S[2]&128)return new Uint8Array(S);Z!==(S[2]<<8|S[3])&&d(3,"wrong scanline width");const B=new Uint8Array(4*I*k);B.length||d(4,"unable to allocate buffer space");let H=0,C=0;const re=4*Z,O=new Uint8Array(4),Ie=new Uint8Array(re);let Pe=k;for(;Pe>0&&C<S.byteLength;){C+4>S.byteLength&&d(1),O[0]=S[C++],O[1]=S[C++],O[2]=S[C++],O[3]=S[C++],(O[0]!=2||O[1]!=2||(O[2]<<8|O[3])!=Z)&&d(3,"bad rgbe scanline format");let xe=0,K;for(;xe<re&&C<S.byteLength;){K=S[C++];const te=K>128;if(te&&(K-=128),(K===0||xe+K>re)&&d(3,"bad scanline data"),te){const he=S[C++];for(let be=0;be<K;be++)Ie[xe++]=he}else Ie.set(S.subarray(C,C+K),xe),xe+=K,C+=K}const Ne=Z;for(let te=0;te<Ne;te++){let he=0;B[H]=Ie[te+he],he+=Z,B[H+1]=Ie[te+he],he+=Z,B[H+2]=Ie[te+he],he+=Z,B[H+3]=Ie[te+he],H+=4}Pe--}return B},G=function(S,I,k,Z){const B=S[I+3],H=Math.pow(2,B-128)/255;k[Z+0]=S[I+0]*H,k[Z+1]=S[I+1]*H,k[Z+2]=S[I+2]*H,k[Z+3]=1},de=function(S,I,k,Z){const B=S[I+3],H=Math.pow(2,B-128)/255;k[Z+0]=Ge.toHalfFloat(Math.min(S[I+0]*H,65504)),k[Z+1]=Ge.toHalfFloat(Math.min(S[I+1]*H,65504)),k[Z+2]=Ge.toHalfFloat(Math.min(S[I+2]*H,65504)),k[Z+3]=Ge.toHalfFloat(1)},$=new Uint8Array(t);$.pos=0;const ie=b($),oe=ie.width,pe=ie.height,le=L($.subarray($.pos),oe,pe);let P,N,ee;switch(this.type){case Oe:ee=le.length/4;const S=new Float32Array(ee*4);for(let k=0;k<ee;k++)G(le,k*4,S,k*4);P=S,N=Oe;break;case Me:ee=le.length/4;const I=new Uint16Array(ee*4);for(let k=0;k<ee;k++)de(le,k*4,I,k*4);P=I,N=Me;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:oe,height:pe,data:P,header:ie.string,gamma:ie.gamma,exposure:ie.exposure,type:N}}setDataType(t){return this.type=t,this}load(t,i,s,u){function h(d,E){switch(d.type){case Oe:case Me:"colorSpace"in d?d.colorSpace="srgb-linear":d.encoding=3e3,d.minFilter=Re,d.magFilter=Re,d.generateMipmaps=!1,d.flipY=!0;break}i&&i(d,E)}return super.load(t,h,s,u)}}const Qe=Xr>=152;class Ia extends zr{constructor(t){super(t),this.type=Me}parse(t){const I=Math.pow(2.7182818,2.2);function k(e,r){for(var a=0,o=0;o<65536;++o)(o==0||e[o>>3]&1<<(o&7))&&(r[a++]=o);for(var l=a-1;a<65536;)r[a++]=0;return l}function Z(e){for(var r=0;r<16384;r++)e[r]={},e[r].len=0,e[r].lit=0,e[r].p=null}const B={l:0,c:0,lc:0};function H(e,r,a,o,l){for(;a<e;)r=r<<8|Br(o,l),a+=8;a-=e,B.l=r>>a&(1<<e)-1,B.c=r,B.lc=a}const C=new Array(59);function re(e){for(var r=0;r<=58;++r)C[r]=0;for(var r=0;r<65537;++r)C[e[r]]+=1;for(var a=0,r=58;r>0;--r){var o=a+C[r]>>1;C[r]=a,a=o}for(var r=0;r<65537;++r){var l=e[r];l>0&&(e[r]=l|C[l]++<<6)}}function O(e,r,a,o,l,c,v){for(var p=a,w=0,_=0;l<=c;l++){if(p.value-a.value>o)return!1;H(6,w,_,e,p);var y=B.l;if(w=B.c,_=B.lc,v[l]=y,y==63){if(p.value-a.value>o)throw"Something wrong with hufUnpackEncTable";H(8,w,_,e,p);var m=B.l+6;if(w=B.c,_=B.lc,l+m>c+1)throw"Something wrong with hufUnpackEncTable";for(;m--;)v[l++]=0;l--}else if(y>=59){var m=y-59+2;if(l+m>c+1)throw"Something wrong with hufUnpackEncTable";for(;m--;)v[l++]=0;l--}}re(v)}function Ie(e){return e&63}function Pe(e){return e>>6}function xe(e,r,a,o){for(;r<=a;r++){var l=Pe(e[r]),c=Ie(e[r]);if(l>>c)throw"Invalid table entry";if(c>14){var v=o[l>>c-14];if(v.len)throw"Invalid table entry";if(v.lit++,v.p){var p=v.p;v.p=new Array(v.lit);for(var w=0;w<v.lit-1;++w)v.p[w]=p[w]}else v.p=new Array(1);v.p[v.lit-1]=r}else if(c)for(var _=0,w=1<<14-c;w>0;w--){var v=o[(l<<14-c)+_];if(v.len||v.p)throw"Invalid table entry";v.len=c,v.lit=r,_++}}return!0}const K={c:0,lc:0};function Ne(e,r,a,o){e=e<<8|Br(a,o),r+=8,K.c=e,K.lc=r}const te={c:0,lc:0};function he(e,r,a,o,l,c,v,p,w,_){if(e==r){o<8&&(Ne(a,o,l,v),a=K.c,o=K.lc),o-=8;var y=a>>o,y=new Uint8Array([y])[0];if(w.value+y>_)return!1;for(var m=p[w.value-1];y-- >0;)p[w.value++]=m}else if(w.value<_)p[w.value++]=e;else return!1;te.c=a,te.lc=o}function be(e){return e&65535}function $e(e){var r=be(e);return r>32767?r-65536:r}const X={a:0,b:0};function Fe(e,r){var a=$e(e),o=$e(r),l=o,c=a+(l&1)+(l>>1),v=c,p=c-l;X.a=v,X.b=p}function Ae(e,r){var a=be(e),o=be(r),l=a-(o>>1)&65535,c=o+l-32768&65535;X.a=c,X.b=l}function it(e,r,a,o,l,c,v){for(var p=v<16384,w=a>l?l:a,_=1,y;_<=w;)_<<=1;for(_>>=1,y=_,_>>=1;_>=1;){for(var m=0,ne=m+c*(l-y),x=c*_,T=c*y,F=o*_,U=o*y,Y,V,ce,fe;m<=ne;m+=T){for(var q=m,Ce=m+o*(a-y);q<=Ce;q+=U){var Q=q+F,ue=q+x,Ue=ue+F;p?(Fe(e[q+r],e[ue+r]),Y=X.a,ce=X.b,Fe(e[Q+r],e[Ue+r]),V=X.a,fe=X.b,Fe(Y,V),e[q+r]=X.a,e[Q+r]=X.b,Fe(ce,fe),e[ue+r]=X.a,e[Ue+r]=X.b):(Ae(e[q+r],e[ue+r]),Y=X.a,ce=X.b,Ae(e[Q+r],e[Ue+r]),V=X.a,fe=X.b,Ae(Y,V),e[q+r]=X.a,e[Q+r]=X.b,Ae(ce,fe),e[ue+r]=X.a,e[Ue+r]=X.b)}if(a&_){var ue=q+x;p?Fe(e[q+r],e[ue+r]):Ae(e[q+r],e[ue+r]),Y=X.a,e[ue+r]=X.b,e[q+r]=Y}}if(l&_)for(var q=m,Ce=m+o*(a-y);q<=Ce;q+=U){var Q=q+F;p?Fe(e[q+r],e[Q+r]):Ae(e[q+r],e[Q+r]),Y=X.a,e[Q+r]=X.b,e[q+r]=Y}y=_,_>>=1}return m}function ot(e,r,a,o,l,c,v,p,w,_){for(var y=0,m=0,ne=p,x=Math.trunc(l.value+(c+7)/8);l.value<x;)for(Ne(y,m,a,l),y=K.c,m=K.lc;m>=14;){var T=y>>m-14&16383,F=r[T];if(F.len)m-=F.len,he(F.lit,v,y,m,a,o,l,w,_,ne),y=te.c,m=te.lc;else{if(!F.p)throw"hufDecode issues";var U;for(U=0;U<F.lit;U++){for(var Y=Ie(e[F.p[U]]);m<Y&&l.value<x;)Ne(y,m,a,l),y=K.c,m=K.lc;if(m>=Y&&Pe(e[F.p[U]])==(y>>m-Y&(1<<Y)-1)){m-=Y,he(F.p[U],v,y,m,a,o,l,w,_,ne),y=te.c,m=te.lc;break}}if(U==F.lit)throw"hufDecode issues"}}var V=8-c&7;for(y>>=V,m-=V;m>0;){var F=r[y<<14-m&16383];if(F.len)m-=F.len,he(F.lit,v,y,m,a,o,l,w,_,ne),y=te.c,m=te.lc;else throw"hufDecode issues"}return!0}function Fr(e,r,a,o,l,c){var v={value:0},p=a.value,w=me(r,a),_=me(r,a);a.value+=4;var y=me(r,a);if(a.value+=4,w<0||w>=65537||_<0||_>=65537)throw"Something wrong with HUF_ENCSIZE";var m=new Array(65537),ne=new Array(16384);Z(ne);var x=o-(a.value-p);if(O(e,r,a,x,w,_,m),y>8*(o-(a.value-p)))throw"Something wrong with hufUncompress";xe(m,w,_,ne),ot(m,ne,e,r,a,y,_,c,l,v)}function st(e,r,a){for(var o=0;o<a;++o)r[o]=e[r[o]]}function Ar(e){for(var r=1;r<e.length;r++){var a=e[r-1]+e[r]-128;e[r]=a}}function Ur(e,r){for(var a=0,o=Math.floor((e.length+1)/2),l=0,c=e.length-1;!(l>c||(r[l++]=e[a++],l>c));)r[l++]=e[o++]}function Or(e){for(var r=e.byteLength,a=new Array,o=0,l=new DataView(e);r>0;){var c=l.getInt8(o++);if(c<0){var v=-c;r-=v+1;for(var p=0;p<v;p++)a.push(l.getUint8(o++))}else{var v=c;r-=2;for(var w=l.getUint8(o++),p=0;p<v+1;p++)a.push(w)}}return a}function lt(e,r,a,o,l,c){var Q=new DataView(c.buffer),v=a[e.idx[0]].width,p=a[e.idx[0]].height,w=3,_=Math.floor(v/8),y=Math.ceil(v/8),m=Math.ceil(p/8),ne=v-(y-1)*8,x=p-(m-1)*8,T={value:0},F=new Array(w),U=new Array(w),Y=new Array(w),V=new Array(w),ce=new Array(w);for(let j=0;j<w;++j)ce[j]=r[e.idx[j]],F[j]=j<1?0:F[j-1]+y*m,U[j]=new Float32Array(64),Y[j]=new Uint16Array(64),V[j]=new Uint16Array(y*64);for(let j=0;j<m;++j){var fe=8;j==m-1&&(fe=x);var q=8;for(let ae=0;ae<y;++ae){ae==y-1&&(q=ne);for(let z=0;z<w;++z)Y[z].fill(0),Y[z][0]=l[F[z]++],ct(T,o,Y[z]),ut(Y[z],U[z]),ht(U[z]);dt(U);for(let z=0;z<w;++z)pt(U[z],V[z],ae*64)}let ge=0;for(let ae=0;ae<w;++ae){const z=a[e.idx[ae]].type;for(let Ee=8*j;Ee<8*j+fe;++Ee){ge=ce[ae][Ee];for(let He=0;He<_;++He){const _e=He*64+(Ee&7)*8;Q.setUint16(ge+0*z,V[ae][_e+0],!0),Q.setUint16(ge+2*z,V[ae][_e+1],!0),Q.setUint16(ge+4*z,V[ae][_e+2],!0),Q.setUint16(ge+6*z,V[ae][_e+3],!0),Q.setUint16(ge+8*z,V[ae][_e+4],!0),Q.setUint16(ge+10*z,V[ae][_e+5],!0),Q.setUint16(ge+12*z,V[ae][_e+6],!0),Q.setUint16(ge+14*z,V[ae][_e+7],!0),ge+=16*z}}if(_!=y)for(let Ee=8*j;Ee<8*j+fe;++Ee){const He=ce[ae][Ee]+8*_*2*z,_e=_*64+(Ee&7)*8;for(let De=0;De<q;++De)Q.setUint16(He+De*2*z,V[ae][_e+De],!0)}}}for(var Ce=new Uint16Array(v),Q=new DataView(c.buffer),ue=0;ue<w;++ue){a[e.idx[ue]].decoded=!0;var Ue=a[e.idx[ue]].type;if(a[ue].type==2)for(var qe=0;qe<p;++qe){const j=ce[ue][qe];for(var ye=0;ye<v;++ye)Ce[ye]=Q.getUint16(j+ye*2*Ue,!0);for(var ye=0;ye<v;++ye)Q.setFloat32(j+ye*2*Ue,M(Ce[ye]),!0)}}}function ct(e,r,a){for(var o,l=1;l<64;)o=r[e.value],o==65280?l=64:o>>8==255?l+=o&255:(a[l]=o,l++),e.value++}function ut(e,r){r[0]=M(e[0]),r[1]=M(e[1]),r[2]=M(e[5]),r[3]=M(e[6]),r[4]=M(e[14]),r[5]=M(e[15]),r[6]=M(e[27]),r[7]=M(e[28]),r[8]=M(e[2]),r[9]=M(e[4]),r[10]=M(e[7]),r[11]=M(e[13]),r[12]=M(e[16]),r[13]=M(e[26]),r[14]=M(e[29]),r[15]=M(e[42]),r[16]=M(e[3]),r[17]=M(e[8]),r[18]=M(e[12]),r[19]=M(e[17]),r[20]=M(e[25]),r[21]=M(e[30]),r[22]=M(e[41]),r[23]=M(e[43]),r[24]=M(e[9]),r[25]=M(e[11]),r[26]=M(e[18]),r[27]=M(e[24]),r[28]=M(e[31]),r[29]=M(e[40]),r[30]=M(e[44]),r[31]=M(e[53]),r[32]=M(e[10]),r[33]=M(e[19]),r[34]=M(e[23]),r[35]=M(e[32]),r[36]=M(e[39]),r[37]=M(e[45]),r[38]=M(e[52]),r[39]=M(e[54]),r[40]=M(e[20]),r[41]=M(e[22]),r[42]=M(e[33]),r[43]=M(e[38]),r[44]=M(e[46]),r[45]=M(e[51]),r[46]=M(e[55]),r[47]=M(e[60]),r[48]=M(e[21]),r[49]=M(e[34]),r[50]=M(e[37]),r[51]=M(e[47]),r[52]=M(e[50]),r[53]=M(e[56]),r[54]=M(e[59]),r[55]=M(e[61]),r[56]=M(e[35]),r[57]=M(e[36]),r[58]=M(e[48]),r[59]=M(e[49]),r[60]=M(e[57]),r[61]=M(e[58]),r[62]=M(e[62]),r[63]=M(e[63])}function ht(e){const r=.5*Math.cos(.7853975),a=.5*Math.cos(3.14159/16),o=.5*Math.cos(3.14159/8),l=.5*Math.cos(3*3.14159/16),c=.5*Math.cos(5*3.14159/16),v=.5*Math.cos(3*3.14159/8),p=.5*Math.cos(7*3.14159/16);for(var w=new Array(4),_=new Array(4),y=new Array(4),m=new Array(4),ne=0;ne<8;++ne){var x=ne*8;w[0]=o*e[x+2],w[1]=v*e[x+2],w[2]=o*e[x+6],w[3]=v*e[x+6],_[0]=a*e[x+1]+l*e[x+3]+c*e[x+5]+p*e[x+7],_[1]=l*e[x+1]-p*e[x+3]-a*e[x+5]-c*e[x+7],_[2]=c*e[x+1]-a*e[x+3]+p*e[x+5]+l*e[x+7],_[3]=p*e[x+1]-c*e[x+3]+l*e[x+5]-a*e[x+7],y[0]=r*(e[x+0]+e[x+4]),y[3]=r*(e[x+0]-e[x+4]),y[1]=w[0]+w[3],y[2]=w[1]-w[2],m[0]=y[0]+y[1],m[1]=y[3]+y[2],m[2]=y[3]-y[2],m[3]=y[0]-y[1],e[x+0]=m[0]+_[0],e[x+1]=m[1]+_[1],e[x+2]=m[2]+_[2],e[x+3]=m[3]+_[3],e[x+4]=m[3]-_[3],e[x+5]=m[2]-_[2],e[x+6]=m[1]-_[1],e[x+7]=m[0]-_[0]}for(var T=0;T<8;++T)w[0]=o*e[16+T],w[1]=v*e[16+T],w[2]=o*e[48+T],w[3]=v*e[48+T],_[0]=a*e[8+T]+l*e[24+T]+c*e[40+T]+p*e[56+T],_[1]=l*e[8+T]-p*e[24+T]-a*e[40+T]-c*e[56+T],_[2]=c*e[8+T]-a*e[24+T]+p*e[40+T]+l*e[56+T],_[3]=p*e[8+T]-c*e[24+T]+l*e[40+T]-a*e[56+T],y[0]=r*(e[T]+e[32+T]),y[3]=r*(e[T]-e[32+T]),y[1]=w[0]+w[3],y[2]=w[1]-w[2],m[0]=y[0]+y[1],m[1]=y[3]+y[2],m[2]=y[3]-y[2],m[3]=y[0]-y[1],e[0+T]=m[0]+_[0],e[8+T]=m[1]+_[1],e[16+T]=m[2]+_[2],e[24+T]=m[3]+_[3],e[32+T]=m[3]-_[3],e[40+T]=m[2]-_[2],e[48+T]=m[1]-_[1],e[56+T]=m[0]-_[0]}function dt(e){for(var r=0;r<64;++r){var a=e[0][r],o=e[1][r],l=e[2][r];e[0][r]=a+1.5747*l,e[1][r]=a-.1873*o-.4682*l,e[2][r]=a+1.8556*o}}function pt(e,r,a){for(var o=0;o<64;++o)r[a+o]=Ge.toHalfFloat(vt(e[o]))}function vt(e){return e<=1?Math.sign(e)*Math.pow(Math.abs(e),2.2):Math.sign(e)*Math.pow(I,Math.abs(e)-1)}function Nr(e){return new DataView(e.array.buffer,e.offset.value,e.size)}function gt(e){var r=e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size),a=new Uint8Array(Or(r)),o=new Uint8Array(a.length);return Ar(a),Ur(a,o),new DataView(o.buffer)}function pr(e){var r=e.array.slice(e.offset.value,e.offset.value+e.size),a=sr(r),o=new Uint8Array(a.length);return Ar(a),Ur(a,o),new DataView(o.buffer)}function ft(e){for(var r=e.viewer,a={value:e.offset.value},o=new Uint16Array(e.width*e.scanlineBlockSize*(e.channels*e.type)),l=new Uint8Array(8192),c=0,v=new Array(e.channels),p=0;p<e.channels;p++)v[p]={},v[p].start=c,v[p].end=v[p].start,v[p].nx=e.width,v[p].ny=e.lines,v[p].size=e.type,c+=v[p].nx*v[p].ny*v[p].size;var w=Ye(r,a),_=Ye(r,a);if(_>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(w<=_)for(var p=0;p<_-w+1;p++)l[p+w]=ze(r,a);var y=new Uint16Array(65536),m=k(l,y),ne=me(r,a);Fr(e.array,r,a,ne,o,c);for(var p=0;p<e.channels;++p)for(var x=v[p],T=0;T<v[p].size;++T)it(o,x.start+T,x.nx,x.size,x.ny,x.nx*x.size,m);st(y,o,c);for(var F=0,U=new Uint8Array(o.buffer.byteLength),Y=0;Y<e.lines;Y++)for(var V=0;V<e.channels;V++){var x=v[V],ce=x.nx*x.size,fe=new Uint8Array(o.buffer,x.end*2,ce*2);U.set(fe,F),F+=ce*2,x.end+=ce}return new DataView(U.buffer)}function mt(e){var r=e.array.slice(e.offset.value,e.offset.value+e.size),a=sr(r);const o=e.lines*e.channels*e.width,l=e.type==1?new Uint16Array(o):new Uint32Array(o);let c=0,v=0;const p=new Array(4);for(let w=0;w<e.lines;w++)for(let _=0;_<e.channels;_++){let y=0;switch(e.type){case 1:p[0]=c,p[1]=p[0]+e.width,c=p[1]+e.width;for(let m=0;m<e.width;++m){const ne=a[p[0]++]<<8|a[p[1]++];y+=ne,l[v]=y,v++}break;case 2:p[0]=c,p[1]=p[0]+e.width,p[2]=p[1]+e.width,c=p[2]+e.width;for(let m=0;m<e.width;++m){const ne=a[p[0]++]<<24|a[p[1]++]<<16|a[p[2]++]<<8;y+=ne,l[v]=y,v++}break}}return new DataView(l.buffer)}function Dr(e){var r=e.viewer,a={value:e.offset.value},o=new Uint8Array(e.width*e.lines*(e.channels*e.type*2)),l={version:we(r,a),unknownUncompressedSize:we(r,a),unknownCompressedSize:we(r,a),acCompressedSize:we(r,a),dcCompressedSize:we(r,a),rleCompressedSize:we(r,a),rleUncompressedSize:we(r,a),rleRawSize:we(r,a),totalAcUncompressedCount:we(r,a),totalDcUncompressedCount:we(r,a),acCompression:we(r,a)};if(l.version<2)throw"EXRLoader.parse: "+Ve.compression+" version "+l.version+" is unsupported";for(var c=new Array,v=Ye(r,a)-2;v>0;){var p=ir(r.buffer,a),w=ze(r,a),_=w>>2&3,y=(w>>4)-1,m=new Int8Array([y])[0],ne=ze(r,a);c.push({name:p,index:m,type:ne,compression:_}),v-=p.length+3}for(var x=Ve.channels,T=new Array(e.channels),F=0;F<e.channels;++F){var U=T[F]={},Y=x[F];U.name=Y.name,U.compression=0,U.decoded=!1,U.type=Y.pixelType,U.pLinear=Y.pLinear,U.width=e.width,U.height=e.lines}for(var V={idx:new Array(3)},ce=0;ce<e.channels;++ce)for(var U=T[ce],F=0;F<c.length;++F){var fe=c[F];U.name==fe.name&&(U.compression=fe.compression,fe.index>=0&&(V.idx[fe.index]=ce),U.offset=ce)}if(l.acCompressedSize>0)switch(l.acCompression){case 0:var Q=new Uint16Array(l.totalAcUncompressedCount);Fr(e.array,r,a,l.acCompressedSize,Q,l.totalAcUncompressedCount);break;case 1:var q=e.array.slice(a.value,a.value+l.totalAcUncompressedCount),Ce=sr(q),Q=new Uint16Array(Ce.buffer);a.value+=l.totalAcUncompressedCount;break}if(l.dcCompressedSize>0){var ue={array:e.array,offset:a,size:l.dcCompressedSize},Ue=new Uint16Array(pr(ue).buffer);a.value+=l.dcCompressedSize}if(l.rleRawSize>0){var q=e.array.slice(a.value,a.value+l.rleCompressedSize),Ce=sr(q),qe=Or(Ce.buffer);a.value+=l.rleCompressedSize}for(var ye=0,j=new Array(T.length),F=0;F<j.length;++F)j[F]=new Array;for(var ge=0;ge<e.lines;++ge)for(var ae=0;ae<T.length;++ae)j[ae].push(ye),ye+=T[ae].width*e.type*2;lt(V,j,T,Q,Ue,o);for(var F=0;F<T.length;++F){var U=T[F];if(!U.decoded)switch(U.compression){case 2:for(var z=0,Ee=0,ge=0;ge<e.lines;++ge){for(var He=j[F][z],_e=0;_e<U.width;++_e){for(var De=0;De<2*U.type;++De)o[He++]=qe[Ee+De*U.width*U.height];Ee++}z++}break;case 1:default:throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(o.buffer)}function ir(e,r){for(var a=new Uint8Array(e),o=0;a[r.value+o]!=0;)o+=1;var l=new TextDecoder().decode(a.slice(r.value,r.value+o));return r.value=r.value+o+1,l}function _t(e,r,a){var o=new TextDecoder().decode(new Uint8Array(e).slice(r.value,r.value+a));return r.value=r.value+a,o}function wt(e,r){var a=Xe(e,r),o=me(e,r);return[a,o]}function yt(e,r){var a=me(e,r),o=me(e,r);return[a,o]}function Xe(e,r){var a=e.getInt32(r.value,!0);return r.value=r.value+4,a}function me(e,r){var a=e.getUint32(r.value,!0);return r.value=r.value+4,a}function Br(e,r){var a=e[r.value];return r.value=r.value+1,a}function ze(e,r){var a=e.getUint8(r.value);return r.value=r.value+1,a}const we=function(e,r){let a;return"getBigInt64"in DataView.prototype?a=Number(e.getBigInt64(r.value,!0)):a=e.getUint32(r.value+4,!0)+Number(e.getUint32(r.value,!0)<<32),r.value+=8,a};function ve(e,r){var a=e.getFloat32(r.value,!0);return r.value+=4,a}function Et(e,r){return Ge.toHalfFloat(ve(e,r))}function M(e){var r=(e&31744)>>10,a=e&1023;return(e>>15?-1:1)*(r?r===31?a?NaN:1/0:Math.pow(2,r-15)*(1+a/1024):6103515625e-14*(a/1024))}function Ye(e,r){var a=e.getUint16(r.value,!0);return r.value+=2,a}function St(e,r){return M(Ye(e,r))}function Mt(e,r,a,o){for(var l=a.value,c=[];a.value<l+o-1;){var v=ir(r,a),p=Xe(e,a),w=ze(e,a);a.value+=3;var _=Xe(e,a),y=Xe(e,a);c.push({name:v,pixelType:p,pLinear:w,xSampling:_,ySampling:y})}return a.value+=1,c}function It(e,r){var a=ve(e,r),o=ve(e,r),l=ve(e,r),c=ve(e,r),v=ve(e,r),p=ve(e,r),w=ve(e,r),_=ve(e,r);return{redX:a,redY:o,greenX:l,greenY:c,blueX:v,blueY:p,whiteX:w,whiteY:_}}function xt(e,r){var a=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],o=ze(e,r);return a[o]}function Tt(e,r){var a=me(e,r),o=me(e,r),l=me(e,r),c=me(e,r);return{xMin:a,yMin:o,xMax:l,yMax:c}}function bt(e,r){var a=["INCREASING_Y"],o=ze(e,r);return a[o]}function Ct(e,r){var a=ve(e,r),o=ve(e,r);return[a,o]}function Rt(e,r){var a=ve(e,r),o=ve(e,r),l=ve(e,r);return[a,o,l]}function Ft(e,r,a,o,l){if(o==="string"||o==="stringvector"||o==="iccProfile")return _t(r,a,l);if(o==="chlist")return Mt(e,r,a,l);if(o==="chromaticities")return It(e,a);if(o==="compression")return xt(e,a);if(o==="box2i")return Tt(e,a);if(o==="lineOrder")return bt(e,a);if(o==="float")return ve(e,a);if(o==="v2f")return Ct(e,a);if(o==="v3f")return Rt(e,a);if(o==="int")return Xe(e,a);if(o==="rational")return wt(e,a);if(o==="timecode")return yt(e,a);if(o==="preview")return a.value+=l,"skipped";a.value+=l}function At(e,r,a){const o={};if(e.getUint32(0,!0)!=20000630)throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";o.version=e.getUint8(4);const l=e.getUint8(5);o.spec={singleTile:!!(l&2),longName:!!(l&4),deepFormat:!!(l&8),multiPart:!!(l&16)},a.value=8;for(var c=!0;c;){var v=ir(r,a);if(v==0)c=!1;else{var p=ir(r,a),w=me(e,a),_=Ft(e,r,a,p,w);_===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${p}'.`):o[v]=_}}if((l&-5)!=0)throw console.error("EXRHeader:",o),"THREE.EXRLoader: provided file is currently unsupported.";return o}function Ut(e,r,a,o,l){const c={size:0,viewer:r,array:a,offset:o,width:e.dataWindow.xMax-e.dataWindow.xMin+1,height:e.dataWindow.yMax-e.dataWindow.yMin+1,channels:e.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:e.channels[0].pixelType,uncompress:null,getter:null,format:null,[Qe?"colorSpace":"encoding"]:null};switch(e.compression){case"NO_COMPRESSION":c.lines=1,c.uncompress=Nr;break;case"RLE_COMPRESSION":c.lines=1,c.uncompress=gt;break;case"ZIPS_COMPRESSION":c.lines=1,c.uncompress=pr;break;case"ZIP_COMPRESSION":c.lines=16,c.uncompress=pr;break;case"PIZ_COMPRESSION":c.lines=32,c.uncompress=ft;break;case"PXR24_COMPRESSION":c.lines=16,c.uncompress=mt;break;case"DWAA_COMPRESSION":c.lines=32,c.uncompress=Dr;break;case"DWAB_COMPRESSION":c.lines=256,c.uncompress=Dr;break;default:throw"EXRLoader.parse: "+e.compression+" is unsupported"}if(c.scanlineBlockSize=c.lines,c.type==1)switch(l){case Oe:c.getter=St,c.inputSize=2;break;case Me:c.getter=Ye,c.inputSize=2;break}else if(c.type==2)switch(l){case Oe:c.getter=ve,c.inputSize=4;break;case Me:c.getter=Et,c.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+c.type+" for "+e.compression+".";c.blockCount=(e.dataWindow.yMax+1)/c.scanlineBlockSize;for(var v=0;v<c.blockCount;v++)we(r,o);c.outputChannels=c.channels==3?4:c.channels;const p=c.width*c.height*c.outputChannels;switch(l){case Oe:c.byteArray=new Float32Array(p),c.channels<c.outputChannels&&c.byteArray.fill(1,0,p);break;case Me:c.byteArray=new Uint16Array(p),c.channels<c.outputChannels&&c.byteArray.fill(15360,0,p);break;default:console.error("THREE.EXRLoader: unsupported type: ",l);break}return c.bytesPerLine=c.width*c.inputSize*c.channels,c.outputChannels==4?c.format=rr:c.format=Lt,Qe?c.colorSpace="srgb-linear":c.encoding=3e3,c}const or=new DataView(t),Ot=new Uint8Array(t),je={value:0},Ve=At(or,t,je),D=Ut(Ve,or,Ot,je,this.type),kr={value:0},Nt={R:0,G:1,B:2,A:3,Y:0};for(let e=0;e<D.height/D.scanlineBlockSize;e++){const r=me(or,je);D.size=me(or,je),D.lines=r+D.scanlineBlockSize>D.height?D.height-r:D.scanlineBlockSize;const o=D.size<D.lines*D.bytesPerLine?D.uncompress(D):Nr(D);je.value+=D.size;for(let l=0;l<D.scanlineBlockSize;l++){const c=l+e*D.scanlineBlockSize;if(c>=D.height)break;for(let v=0;v<D.channels;v++){const p=Nt[Ve.channels[v].name];for(let w=0;w<D.width;w++){kr.value=(l*(D.channels*D.width)+v*D.width+w)*D.inputSize;const _=(D.height-1-c)*(D.width*D.outputChannels)+w*D.outputChannels+p;D.byteArray[_]=D.getter(o,kr)}}}}return{header:Ve,width:D.width,height:D.height,data:D.byteArray,format:D.format,[Qe?"colorSpace":"encoding"]:D[Qe?"colorSpace":"encoding"],type:this.type}}setDataType(t){return this.type=t,this}load(t,i,s,u){function h(d,E){Qe?d.colorSpace=E.colorSpace:d.encoding=E.encoding,d.minFilter=Re,d.magFilter=Re,d.generateMipmaps=!1,d.flipY=!1,i&&i(d,E)}return super.load(t,h,s,u)}}const Jr=(n,t,i)=>{let s;switch(n){case _r:s=new Uint8ClampedArray(t*i*4);break;case Me:s=new Uint16Array(t*i*4);break;case Xt:s=new Uint32Array(t*i*4);break;case $t:s=new Int8Array(t*i*4);break;case Wt:s=new Int16Array(t*i*4);break;case Zt:s=new Int32Array(t*i*4);break;case Oe:s=new Float32Array(t*i*4);break;default:throw new Error("Unsupported data type")}return s};let lr;const xa=(n,t,i,s)=>{if(lr!==void 0)return lr;const u=new Wr(1,1,s);t.setRenderTarget(u);const h=new Er(new Zr,new Gt({color:16777215}));t.render(h,i),t.setRenderTarget(null);const d=Jr(n,u.width,u.height);return t.readRenderTargetPixels(u,0,0,u.width,u.height,d),u.dispose(),h.geometry.dispose(),h.material.dispose(),lr=d[0]!==0,lr};class Mr{_renderer;_rendererIsDisposable=!1;_material;_scene;_camera;_quad;_renderTarget;_width;_height;_type;_colorSpace;_supportsReadPixels=!0;constructor(t){this._width=t.width,this._height=t.height,this._type=t.type,this._colorSpace=t.colorSpace;const i={format:rr,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:t.renderTargetOptions?.anisotropy!==void 0?t.renderTargetOptions?.anisotropy:1,generateMipmaps:t.renderTargetOptions?.generateMipmaps!==void 0?t.renderTargetOptions?.generateMipmaps:!1,magFilter:t.renderTargetOptions?.magFilter!==void 0?t.renderTargetOptions?.magFilter:Re,minFilter:t.renderTargetOptions?.minFilter!==void 0?t.renderTargetOptions?.minFilter:Re,samples:t.renderTargetOptions?.samples!==void 0?t.renderTargetOptions?.samples:void 0,wrapS:t.renderTargetOptions?.wrapS!==void 0?t.renderTargetOptions?.wrapS:ke,wrapT:t.renderTargetOptions?.wrapT!==void 0?t.renderTargetOptions?.wrapT:ke};if(this._material=t.material,t.renderer?this._renderer=t.renderer:(this._renderer=Mr.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new Gr,this._camera=new Pt,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!xa(this._type,this._renderer,this._camera,i)){let s;switch(this._type){case Me:s=this._renderer.extensions.has("EXT_color_buffer_float")?Oe:void 0;break}s!==void 0?(console.warn(`This browser does not support reading pixels from ${this._type} RenderTargets, switching to ${Oe}`),this._type=s):(this._supportsReadPixels=!1,console.warn("This browser dos not support toArray or toDataTexture, calls to those methods will result in an error thrown"))}this._quad=new Er(new Zr,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new Wr(this.width,this.height,i),this._renderTarget.texture.mapping=t.renderTargetOptions?.mapping!==void 0?t.renderTargetOptions?.mapping:ur}static instantiateRenderer(){const t=new Ht;return t.setSize(128,128),t}render=()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(t){throw this._renderer.setRenderTarget(null),t}this._renderer.setRenderTarget(null)};toArray(){if(!this._supportsReadPixels)throw new Error("Can't read pixels in this browser");const t=Jr(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,t),t}toDataTexture(t){const i=new zt(this.toArray(),this.width,this.height,rr,this._type,t?.mapping||ur,t?.wrapS||ke,t?.wrapT||ke,t?.magFilter||Re,t?.minFilter||Re,t?.anisotropy||1,mr);return i.generateMipmaps=t?.generateMipmaps!==void 0?t?.generateMipmaps:!1,i}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(t){this.disposeOnDemandRenderer(),t&&this.renderTarget.dispose(),this.material instanceof Sr&&Object.values(this.material.uniforms).forEach(i=>{i.value instanceof Ze&&i.value.dispose()}),Object.values(this.material).forEach(i=>{i instanceof Ze&&i.dispose()}),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(t){this._width=t,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(t){this._height=t,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(t){this._renderTarget=t,this._width=t.width,this._height=t.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}}class et extends Error{}class rt extends Error{}const Je=(n,t,i)=>{const s=new RegExp(`${t}="([^"]*)"`,"i").exec(n);if(s)return s[1];const u=new RegExp(`<${t}[^>]*>([\\s\\S]*?)</${t}>`,"i").exec(n);if(u){const h=u[1].match(/<rdf:li>([^<]*)<\/rdf:li>/g);return h&&h.length===3?h.map(d=>d.replace(/<\/?rdf:li>/g,"")):u[1].trim()}if(i!==void 0)return i;throw new Error(`Can't find ${t} in gainmap metadata`)},Ta=n=>{let t;typeof TextDecoder<"u"?t=new TextDecoder().decode(n):t=n.toString();let i=t.indexOf("<x:xmpmeta");for(;i!==-1;){const s=t.indexOf("x:xmpmeta>",i),u=t.slice(i,s+10);try{const h=Je(u,"hdrgm:GainMapMin","0"),d=Je(u,"hdrgm:GainMapMax"),E=Je(u,"hdrgm:Gamma","1"),g=Je(u,"hdrgm:OffsetSDR","0.015625"),f=Je(u,"hdrgm:OffsetHDR","0.015625"),A=/hdrgm:HDRCapacityMin="([^"]*)"/.exec(u),R=A?A[1]:"0",b=/hdrgm:HDRCapacityMax="([^"]*)"/.exec(u);if(!b)throw new Error("Incomplete gainmap metadata");const L=b[1];return{gainMapMin:Array.isArray(h)?h.map(G=>parseFloat(G)):[parseFloat(h),parseFloat(h),parseFloat(h)],gainMapMax:Array.isArray(d)?d.map(G=>parseFloat(G)):[parseFloat(d),parseFloat(d),parseFloat(d)],gamma:Array.isArray(E)?E.map(G=>parseFloat(G)):[parseFloat(E),parseFloat(E),parseFloat(E)],offsetSdr:Array.isArray(g)?g.map(G=>parseFloat(G)):[parseFloat(g),parseFloat(g),parseFloat(g)],offsetHdr:Array.isArray(f)?f.map(G=>parseFloat(G)):[parseFloat(f),parseFloat(f),parseFloat(f)],hdrCapacityMin:parseFloat(R),hdrCapacityMax:parseFloat(L)}}catch{}i=t.indexOf("<x:xmpmeta",s)}};class ba{options;constructor(t){this.options={debug:t&&t.debug!==void 0?t.debug:!1,extractFII:t&&t.extractFII!==void 0?t.extractFII:!0,extractNonFII:t&&t.extractNonFII!==void 0?t.extractNonFII:!0}}extract(t){return new Promise((i,s)=>{const u=this.options.debug,h=new DataView(t.buffer);if(h.getUint16(0)!==65496){s(new Error("Not a valid jpeg"));return}const d=h.byteLength;let E=2,g=0,f;for(;E<d;){if(++g>250){s(new Error(`Found no marker after ${g} loops ðŸ˜µ`));return}if(h.getUint8(E)!==255){s(new Error(`Not a valid marker at offset 0x${E.toString(16)}, found: 0x${h.getUint8(E).toString(16)}`));return}if(f=h.getUint8(E+1),u&&console.log(`Marker: ${f.toString(16)}`),f===226){u&&console.log("Found APP2 marker (0xffe2)");const A=E+4;if(h.getUint32(A)===1297106432){const R=A+4;let b;if(h.getUint16(R)===18761)b=!1;else if(h.getUint16(R)===19789)b=!0;else{s(new Error("No valid endianness marker found in TIFF header"));return}if(h.getUint16(R+2,!b)!==42){s(new Error("Not valid TIFF data! (no 0x002A marker)"));return}const L=h.getUint32(R+4,!b);if(L<8){s(new Error("Not valid TIFF data! (First offset less than 8)"));return}const G=R+L,de=h.getUint16(G,!b),$=G+2;let ie=0;for(let P=$;P<$+12*de;P+=12)h.getUint16(P,!b)===45057&&(ie=h.getUint32(P+8,!b));const pe=G+2+de*12+4,le=[];for(let P=pe;P<pe+ie*16;P+=16){const N={MPType:h.getUint32(P,!b),size:h.getUint32(P+4,!b),dataOffset:h.getUint32(P+8,!b),dependantImages:h.getUint32(P+12,!b),start:-1,end:-1,isFII:!1};N.dataOffset?(N.start=R+N.dataOffset,N.isFII=!1):(N.start=0,N.isFII=!0),N.end=N.start+N.size,le.push(N)}if(this.options.extractNonFII&&le.length){const P=new Blob([h]),N=[];for(const ee of le){if(ee.isFII&&!this.options.extractFII)continue;const S=P.slice(ee.start,ee.end+1,"image/jpeg");N.push(S)}i(N)}}}E+=2+h.getUint16(E+2)}})}}const Ca=async n=>{const t=Ta(n);if(!t)throw new rt("Gain map XMP metadata not found");const s=await new ba({extractFII:!0,extractNonFII:!0}).extract(n);if(s.length!==2)throw new et("Gain map recovery image not found");return{sdr:new Uint8Array(await s[0].arrayBuffer()),gainMap:new Uint8Array(await s[1].arrayBuffer()),metadata:t}},Hr=n=>new Promise((t,i)=>{const s=document.createElement("img");s.onload=()=>{t(s)},s.onerror=u=>{i(u)},s.src=URL.createObjectURL(n)});class Ra extends Yt{_renderer;_renderTargetOptions;_internalLoadingManager;_config;constructor(t,i){super(i),this._config=t,t.renderer&&(this._renderer=t.renderer),this._internalLoadingManager=new jt}setRenderer(t){return this._renderer=t,this}setRenderTargetOptions(t){return this._renderTargetOptions=t,this}prepareQuadRenderer(){this._renderer||console.warn("WARNING: A Renderer was not passed to this Loader constructor or in setRenderer, the result of this Loader will need to be converted to a Data Texture with toDataTexture() before you can use it in your renderer.");const t=this._config.createMaterial({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new Ze,sdr:new Ze});return this._config.createQuadRenderer({width:16,height:16,type:Me,colorSpace:mr,material:t,renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async processImages(t,i,s){const u=i?new Blob([i],{type:"image/jpeg"}):void 0,h=new Blob([t],{type:"image/jpeg"});let d,E,g=!1;if(typeof createImageBitmap>"u"){const f=await Promise.all([u?Hr(u):Promise.resolve(void 0),Hr(h)]);E=f[0],d=f[1],g=s==="flipY"}else{const f=await Promise.all([u?createImageBitmap(u,{imageOrientation:s||"flipY"}):Promise.resolve(void 0),createImageBitmap(h,{imageOrientation:s||"flipY"})]);E=f[0],d=f[1]}return{sdrImage:d,gainMapImage:E,needsFlip:g}}createTextures(t,i,s){const u=new Ze(i||new ImageData(2,2),ur,ke,ke,Re,Lr,rr,_r,1,mr);u.flipY=s,u.needsUpdate=!0;const h=new Ze(t,ur,ke,ke,Re,Lr,rr,_r,1,Vt);return h.flipY=s,h.needsUpdate=!0,{gainMap:u,sdr:h}}updateQuadRenderer(t,i,s,u,h){t.width=i.width,t.height=i.height,t.material.gainMap=s,t.material.sdr=u,t.material.gainMapMin=h.gainMapMin,t.material.gainMapMax=h.gainMapMax,t.material.offsetHdr=h.offsetHdr,t.material.offsetSdr=h.offsetSdr,t.material.gamma=h.gamma,t.material.hdrCapacityMin=h.hdrCapacityMin,t.material.hdrCapacityMax=h.hdrCapacityMax,t.material.maxDisplayBoost=Math.pow(2,h.hdrCapacityMax),t.material.needsUpdate=!0}}const Fa=`
varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,Aa=`
// min half float value
#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )
// max half float value
#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )

uniform sampler2D sdr;
uniform sampler2D gainMap;
uniform vec3 gamma;
uniform vec3 offsetHdr;
uniform vec3 offsetSdr;
uniform vec3 gainMapMin;
uniform vec3 gainMapMax;
uniform float weightFactor;

varying vec2 vUv;

void main() {
  vec3 rgb = texture2D( sdr, vUv ).rgb;
  vec3 recovery = texture2D( gainMap, vUv ).rgb;
  vec3 logRecovery = pow( recovery, gamma );
  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;
  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;
  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));
  gl_FragColor = vec4( clampedHdrColor , 1.0 );
}
`;class Ua extends Sr{_maxDisplayBoost;_hdrCapacityMin;_hdrCapacityMax;constructor({gamma:t,offsetHdr:i,offsetSdr:s,gainMapMin:u,gainMapMax:h,maxDisplayBoost:d,hdrCapacityMin:E,hdrCapacityMax:g,sdr:f,gainMap:A}){super({name:"GainMapDecoderMaterial",vertexShader:Fa,fragmentShader:Aa,uniforms:{sdr:{value:f},gainMap:{value:A},gamma:{value:new Ke(1/t[0],1/t[1],1/t[2])},offsetHdr:{value:new Ke().fromArray(i)},offsetSdr:{value:new Ke().fromArray(s)},gainMapMin:{value:new Ke().fromArray(u)},gainMapMax:{value:new Ke().fromArray(h)},weightFactor:{value:(Math.log2(d)-E)/(g-E)}},blending:qt,depthTest:!1,depthWrite:!1}),this._maxDisplayBoost=d,this._hdrCapacityMin=E,this._hdrCapacityMax=g,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(t){this.uniforms.sdr.value=t}get gainMap(){return this.uniforms.gainMap.value}set gainMap(t){this.uniforms.gainMap.value=t}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(t){this.uniforms.offsetHdr.value.fromArray(t)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(t){this.uniforms.offsetSdr.value.fromArray(t)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(t){this.uniforms.gainMapMin.value.fromArray(t)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(t){this.uniforms.gainMapMax.value.fromArray(t)}get gamma(){const t=this.uniforms.gamma.value;return[1/t.x,1/t.y,1/t.z]}set gamma(t){const i=this.uniforms.gamma.value;i.x=1/t[0],i.y=1/t[1],i.z=1/t[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(t){this._hdrCapacityMin=t,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(t){this._hdrCapacityMax=t,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(t){this._maxDisplayBoost=Math.max(1,Math.min(65504,t)),this.calculateWeight()}calculateWeight(){const t=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,t))}}class tt extends Ra{constructor(t,i){super({renderer:t,createMaterial:s=>new Ua(s),createQuadRenderer:s=>new Mr(s)},i)}async render(t,i,s,u){const{sdrImage:h,gainMapImage:d,needsFlip:E}=await this.processImages(s,u,"flipY"),{gainMap:g,sdr:f}=this.createTextures(h,d,E);this.updateQuadRenderer(t,h,g,f,i),t.render()}}class Oa extends tt{load([t,i,s],u,h,d){const E=this.prepareQuadRenderer();let g,f,A;const R=async()=>{if(g&&f&&A){try{await this.render(E,A,g,f)}catch(I){this.manager.itemError(t),this.manager.itemError(i),this.manager.itemError(s),typeof d=="function"&&d(I),E.disposeOnDemandRenderer();return}typeof u=="function"&&u(E),this.manager.itemEnd(t),this.manager.itemEnd(i),this.manager.itemEnd(s),E.disposeOnDemandRenderer()}};let b=!0,L=0,G=0,de=!0,$=0,ie=0,oe=!0,pe=0,le=0;const P=()=>{if(typeof h=="function"){const I=L+$+pe,k=G+ie+le,Z=b&&de&&oe;h(new ProgressEvent("progress",{lengthComputable:Z,loaded:k,total:I}))}};this.manager.itemStart(t),this.manager.itemStart(i),this.manager.itemStart(s);const N=new cr(this._internalLoadingManager);N.setResponseType("arraybuffer"),N.setRequestHeader(this.requestHeader),N.setPath(this.path),N.setWithCredentials(this.withCredentials),N.load(t,async I=>{if(typeof I=="string")throw new Error("Invalid sdr buffer");g=I,await R()},I=>{b=I.lengthComputable,G=I.loaded,L=I.total,P()},I=>{this.manager.itemError(t),typeof d=="function"&&d(I)});const ee=new cr(this._internalLoadingManager);ee.setResponseType("arraybuffer"),ee.setRequestHeader(this.requestHeader),ee.setPath(this.path),ee.setWithCredentials(this.withCredentials),ee.load(i,async I=>{if(typeof I=="string")throw new Error("Invalid gainmap buffer");f=I,await R()},I=>{de=I.lengthComputable,ie=I.loaded,$=I.total,P()},I=>{this.manager.itemError(i),typeof d=="function"&&d(I)});const S=new cr(this._internalLoadingManager);return S.setRequestHeader(this.requestHeader),S.setPath(this.path),S.setWithCredentials(this.withCredentials),S.load(s,async I=>{if(typeof I!="string")throw new Error("Invalid metadata string");A=JSON.parse(I),await R()},I=>{oe=I.lengthComputable,le=I.loaded,pe=I.total,P()},I=>{this.manager.itemError(s),typeof d=="function"&&d(I)}),E}}class Na extends tt{load(t,i,s,u){const h=this.prepareQuadRenderer(),d=new cr(this._internalLoadingManager);return d.setResponseType("arraybuffer"),d.setRequestHeader(this.requestHeader),d.setPath(this.path),d.setWithCredentials(this.withCredentials),this.manager.itemStart(t),d.load(t,async E=>{if(typeof E=="string")throw new Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");const g=new Uint8Array(E);let f,A,R;try{const b=await Ca(g);f=b.sdr,A=b.gainMap,R=b.metadata}catch(b){if(b instanceof rt||b instanceof et)console.warn(`Failure to reconstruct an HDR image from ${t}: Gain map metadata not found in the file, HDRJPGLoader will render the SDR jpeg`),R={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},f=g;else throw b}try{await this.render(h,R,f.buffer,A?.buffer)}catch(b){this.manager.itemError(t),typeof u=="function"&&u(b),h.disposeOnDemandRenderer();return}typeof i=="function"&&i(h),this.manager.itemEnd(t),h.disposeOnDemandRenderer()},s,E=>{this.manager.itemError(t),typeof u=="function"&&u(E)}),h}}const ar={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},at="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",We=n=>Array.isArray(n),Ir=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"];function dr({files:n=Ir,path:t="",preset:i=void 0,colorSpace:s=void 0,extensions:u}={}){i&&(xr(i),n=ar[i],t=at);const h=We(n),{extension:d,isCubemap:E}=Tr(n),g=br(d);if(!g)throw new Error("useEnvironment: Unrecognized file extension: "+n);const f=tr(L=>L.gl);W.useLayoutEffect(()=>{if(d!=="webp"&&d!=="jpg"&&d!=="jpeg")return;function L(){hr.clear(g,h?[n]:n)}f.domElement.addEventListener("webglcontextlost",L,{once:!0})},[n,f.domElement]);const A=hr(g,h?[n]:n,L=>{(d==="webp"||d==="jpg"||d==="jpeg")&&L.setRenderer(f),L.setPath==null||L.setPath(t),u&&u(L)});let R=h?A[0]:A;if(d==="jpg"||d==="jpeg"||d==="webp"){var b;R=(b=R.renderTarget)==null?void 0:b.texture}return R.mapping=E?Kt:Qt,R.colorSpace=s??(E?"srgb":"srgb-linear"),R}const Da={files:Ir,path:"",preset:void 0,extensions:void 0};dr.preload=n=>{const t={...Da,...n};let{files:i,path:s=""}=t;const{preset:u,extensions:h}=t;u&&(xr(u),i=ar[u],s=at);const{extension:d}=Tr(i);if(d==="webp"||d==="jpg"||d==="jpeg")throw new Error("useEnvironment: Preloading gainmaps is not supported");const E=br(d);if(!E)throw new Error("useEnvironment: Unrecognized file extension: "+i);hr.preload(E,We(i)?[i]:i,g=>{g.setPath==null||g.setPath(s),h&&h(g)})};const Ba={files:Ir,preset:void 0};dr.clear=n=>{const t={...Ba,...n};let{files:i}=t;const{preset:s}=t;s&&(xr(s),i=ar[s]);const{extension:u}=Tr(i),h=br(u);if(!h)throw new Error("useEnvironment: Unrecognized file extension: "+i);hr.clear(h,We(i)?[i]:i)};function xr(n){if(!(n in ar))throw new Error("Preset must be one of: "+Object.keys(ar).join(", "))}function Tr(n){var t;const i=We(n)&&n.length===6,s=We(n)&&n.length===3&&n.some(d=>d.endsWith("json")),u=We(n)?n[0]:n;return{extension:i?"cube":s?"webp":u.startsWith("data:application/exr")?"exr":u.startsWith("data:application/hdr")?"hdr":u.startsWith("data:image/jpeg")?"jpg":(t=u.split(".").pop())==null||(t=t.split("?"))==null||(t=t.shift())==null?void 0:t.toLowerCase(),isCubemap:i,isGainmap:s}}function br(n){return n==="cube"?Jt:n==="hdr"?Ma:n==="exr"?Ia:n==="jpg"||n==="jpeg"?Na:n==="webp"?Oa:null}const ka=n=>n.current&&n.current.isScene,La=n=>ka(n)?n.current:n;function Cr(n,t,i,s,u={}){var h,d,E,g;u={backgroundBlurriness:0,backgroundIntensity:1,backgroundRotation:[0,0,0],environmentIntensity:1,environmentRotation:[0,0,0],...u};const f=La(t||i),A=f.background,R=f.environment,b={backgroundBlurriness:f.backgroundBlurriness,backgroundIntensity:f.backgroundIntensity,backgroundRotation:(h=(d=f.backgroundRotation)==null||d.clone==null?void 0:d.clone())!==null&&h!==void 0?h:[0,0,0],environmentIntensity:f.environmentIntensity,environmentRotation:(E=(g=f.environmentRotation)==null||g.clone==null?void 0:g.clone())!==null&&E!==void 0?E:[0,0,0]};return n!=="only"&&(f.environment=s),n&&(f.background=s),Pr(f,u),()=>{n!=="only"&&(f.environment=R),n&&(f.background=A),Pr(f,b)}}function Rr({scene:n,background:t=!1,map:i,...s}){const u=tr(h=>h.scene);return W.useLayoutEffect(()=>{if(i)return Cr(t,n,u,i,s)}),null}function nt({background:n=!1,scene:t,blur:i,backgroundBlurriness:s,backgroundIntensity:u,backgroundRotation:h,environmentIntensity:d,environmentRotation:E,...g}){const f=dr(g),A=tr(R=>R.scene);return W.useLayoutEffect(()=>Cr(n,t,A,f,{backgroundBlurriness:i??s,backgroundIntensity:u,backgroundRotation:h,environmentIntensity:d,environmentRotation:E})),W.useEffect(()=>()=>{f.dispose()},[f]),null}function Pa({children:n,near:t=.1,far:i=1e3,resolution:s=256,frames:u=1,map:h,background:d=!1,blur:E,backgroundBlurriness:g,backgroundIntensity:f,backgroundRotation:A,environmentIntensity:R,environmentRotation:b,scene:L,files:G,path:de,preset:$=void 0,extensions:ie}){const oe=tr(S=>S.gl),pe=tr(S=>S.scene),le=W.useRef(null),[P]=W.useState(()=>new Gr),N=W.useMemo(()=>{const S=new ta(s);return S.texture.type=Me,S},[s]);W.useEffect(()=>()=>{N.dispose()},[N]),W.useLayoutEffect(()=>{if(u===1){const S=oe.autoClear;oe.autoClear=!0,le.current.update(oe,P),oe.autoClear=S}return Cr(d,L,pe,N.texture,{backgroundBlurriness:E??g,backgroundIntensity:f,backgroundRotation:A,environmentIntensity:R,environmentRotation:b})},[n,P,N.texture,L,pe,d,u,oe]);let ee=1;return $r(()=>{if(u===1/0||ee<u){const S=oe.autoClear;oe.autoClear=!0,le.current.update(oe,P),oe.autoClear=S,ee++}}),W.createElement(W.Fragment,null,aa(W.createElement(W.Fragment,null,n,W.createElement("cubeCamera",{ref:le,args:[t,i,N]}),G||$?W.createElement(nt,{background:!0,files:G,preset:$,path:de,extensions:ie}):h?W.createElement(Rr,{background:!0,map:h,extensions:ie}):null),P))}function Ha(n){var t,i,s,u;const h=dr(n),d=n.map||h;W.useMemo(()=>ea({GroundProjectedEnvImpl:Sa}),[]),W.useEffect(()=>()=>{h.dispose()},[h]);const E=W.useMemo(()=>[d],[d]),g=(t=n.ground)==null?void 0:t.height,f=(i=n.ground)==null?void 0:i.radius,A=(s=(u=n.ground)==null?void 0:u.scale)!==null&&s!==void 0?s:1e3;return W.createElement(W.Fragment,null,W.createElement(Rr,ra({},n,{map:d})),W.createElement("groundProjectedEnvImpl",{args:E,scale:A,height:g,radius:f}))}function za(n){return n.ground?W.createElement(Ha,n):n.map?W.createElement(Rr,n):n.children?W.createElement(Pa,n):W.createElement(nt,n)}function fr({position:n,color:t,speed:i,rotationSpeed:s,geometry:u}){const h=W.useRef();return $r(d=>{const E=d.clock.getElapsedTime();h.current.rotation.x=E*s,h.current.rotation.y=E*s*.5,h.current.position.y=n[1]+Math.sin(E*i)*.2}),se.jsxs("mesh",{ref:h,position:n,children:[se.jsx(u,{args:[1,0]}),se.jsx("meshStandardMaterial",{color:t,roughness:.3,metalness:.8})]})}function Ga(){return se.jsxs(se.Fragment,{children:[se.jsx(ia,{makeDefault:!0,position:[0,0,10]}),se.jsx("ambientLight",{intensity:.5}),se.jsx("pointLight",{position:[10,10,10],intensity:1}),se.jsx("pointLight",{position:[-10,-10,-10],intensity:.5,color:"#4ade80"}),se.jsxs(oa,{speed:2,rotationIntensity:.5,floatIntensity:1,children:[se.jsx(fr,{position:[-3,2,0],color:"#16a34a",speed:1,rotationSpeed:.2,geometry:n=>se.jsx("icosahedronGeometry",{...n,args:[1.2,0]})}),se.jsx(fr,{position:[3,-1,-2],color:"#d97706",speed:1.5,rotationSpeed:.3,geometry:n=>se.jsx("torusGeometry",{...n,args:[.8,.3,16,100]})}),se.jsx(fr,{position:[0,3,-4],color:"#0284c7",speed:.8,rotationSpeed:.1,geometry:n=>se.jsx("octahedronGeometry",{...n,args:[1,0]})})]}),se.jsx(sa,{radius:100,depth:50,count:5e3,factor:4,saturation:0,fade:!0,speed:1}),se.jsx(za,{preset:"city"})]})}function Ya(){return se.jsx("div",{className:"absolute inset-0 z-0 pointer-events-none opacity-60 dark:opacity-40",children:se.jsx(na,{dpr:[1,2],children:se.jsx(Ga,{})})})}export{Ya as default};
